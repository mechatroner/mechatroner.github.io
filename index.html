<!DOCTYPE html>
<html>
<head>

<link rel="icon" href="favicon.png">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120898558-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120898558-1');
</script>

<!-- explanation of version hack: https://stackoverflow.com/questions/32414/how-can-i-force-clients-to-refresh-javascript-files -->
<script src="contrib/textarea-caret-position/index.js"></script>
<script src="contrib/FileSaver/FileSaver.js"></script>
<script src="rbql_suggest.js?version=26"></script>
<script src="web_rbql.js?version=26"></script>
<script src="index.js?version=26"></script>

<title>RBQL - Rainbow Query Language</title>
<style>

body {
    font-family: 'Helvetica', 'Arial', sans-serif;
    color: #444444;
    margin-left: 0px;
    margin-right: 0px;
    margin-top: 0px;
    margin-bottom: 0px;
    font-size: 18px;
    text-size-adjust: none;
    -webkit-text-size-adjust: none;
    -moz-text-size-adjust: none;
    -ms-text-size-adjust: none;
}


.infoheader {
    left: 0;
    bottom: 0;
    width: 100%;
    height: 50px;
    background-color: red;
    margin-top: 0px;
    position: relative;
}

.footer {
    left: 0;
    bottom: 0;
    width: 100%;
    height: 50px;
    margin-top: 40px;
    margin-bottom: 0px;
    background-color: #B418B4;
    position: relative;
}

.content_group {
    margin-left: 40px;
    margin-top: 60px;
}

.description_paragraph {
    margin-bottom: 20px;
    max-width: 1100px;
}

.flex_row {
    display: flex;
}


.red_span {
    color: red;
}

li {
    margin-bottom: 10px;
}


.code_snippet {
    background: #F1F1F1;
    border: 1px solid #E1E1E1;
    margin-bottom: 12px;
    margin-top: 12px;
    padding: 8px;
    border-radius: 4px;
    font-family: "Lucida Console", Monaco, monospace;
}



.code_snippet_small {
    padding: 3px;
    font-size: 14px;
    white-space: nowrap;
    background: #F1F1F1;
    border: 1px solid #E1E1E1;
    border-radius: 4px;
    display: inline-block;
    font-family: "Lucida Console", Monaco, monospace;
}

.code_explanation_small {
    font-size: 16px;
    white-space: nowrap;
    display: inline-block;
}


h1 {
    font-size:32px;
}

#twitter_img {
    float: right;
    margin-right: 10px;
    margin-top: 9px;
}

#facebook_img {
    float: right;
    margin-right: 10px;
    margin-top: 9px;
}

#github_img {
    float: right;
    margin-right: 20px;
    margin-top: 9px;
}

#contacts_block {
    margin-left: 10px;
    display: inline-block;
    margin-top: 16px;
}

.right_header_block {
    margin-right: 20px;
    display: inline-block;
    margin-top: 16px;
    float: right;
}

.simple_link {
    font-size: 18px;
    color: white;
    text-decoration: none;
}





.infoMsg {
    padding: 4px;
    font-size: 16px;
}

table {
    display: block;
    white-space: nowrap;
    border-collapse: collapse;
}


th {
    padding: 3px 8px;
    color: #FFFFFF;
    background-color: #7A7A7A;
    font-size: 18px;
    font-weight: normal;
    text-align: left;
    position: sticky;
    position: -webkit-sticky;
    top: 0;
    border-right: 1px solid black;
    white-space: pre;
}


td {
    padding: 3px 8px;
    font-size: 18px;
    font-weight: normal;
    border-right: 1px solid black;
    border-top: 1px solid black;
}

.nr_cell {
    background-color: #E5E5E5;
}

.standard_margin_top {
    margin-top: 10px;
}

.table_window {
    max-width: 75%;
    max-height: 400px;
    overflow: scroll;
    border: 2px solid black;
}

.table_control_group {
    max-width: 75%;
}

#output_group {
    display: none;
}

.rbql_query_group {
    margin-top: 20px;
    margin-bottom: 20px;
}


textarea {
    font-size: 18px;
    font-family: Consolas, Monaco, monospace;
}


input[type="checkbox"] {
    width: 18px;
    height: 18px;
    vertical-align: bottom;
}

label.checkbox {
    vertical-align: top;
    line-height: 24px;
    margin: 2px 0;
    display: block;
    height: 24px;
}


input {
    margin-right: 10px;
    font-size: 18px;
    vertical-align: bottom;
    font-family: Consolas, Monaco, monospace;
    height: 22px;
}

#open_custom_table_dialog {
    margin-top: 12px;
}


.rbql_run_button {
    width: 70px;
    background-color: #4CAF50;
    display: inline-block;
    border:none;
    font-size: 18px;
    color: white;
    height: 28px;
    font-weight: bold;
    outline: none;
}


.rbql_run_button:hover {
    background-color: #2C8F30;
}


.expandable_block {
    background-color: #FFE2CC;
    padding-top: 10px;
    padding-bottom: 5px;
    padding-right: 5px;
    padding-left: 5px;
}


.expandable_button {
    background-color: #FFE2CC;
    display: block;
    border:none;
    font-size: 18px;
    height: 28px;
    text-align: left;
    outline: none;
    margin-top: 10px;
}

.expandable_button:hover {
    background-color: #CC8B00;
}

.dark_button {
    background-color: #5A5A5A;
    display: block;
    border:none;
    font-size: 18px;
    color: white;
    height: 28px;
    outline: none;
}

.dark_button:hover {
    background-color: #3A3A3A;
}


.tall_button {
    height: 100%;
    display: inline-block;
    white-space: pre;
}


.table_cut_warning {
    color: red;
    font-weight: bold;
    font-size: 18px;
}


.padded_label {
    padding: 5px;
}

#udf_holder {
    display:none;
}


#table_load_dialog {
    padding: 5px;
    width: 50%;
    top: 20%;
    left: 25%;
    z-index: 1000000;
    background-color: #FFFFFF;
    position: fixed;
    display: none;
    color: black;
    border: 1px solid black;
}


#query_suggest{ 
    width: 200px;
    z-index: 1000010; 
    background-color: #FFFFFF; 
    position: fixed; 
    display: none;
    color: black;
    border-top: 1px solid;
    border-left: 1px solid;
    border-right: 1px solid;
    max-height: 300px;
    white-space: nowrap;
    overflow-y: auto;
    overflow-x: hidden;
}


.suggest_button {
    margin: 0px;
    width: 100%;
    background-color: #FFFFFF;
    height: 24px !important;
    color: black;
    font-family: Consolas, Monaco, monospace;
    border-width: 0px;
    outline: none;
    display: block;
    text-align: left;
    padding-left: 2px;
    white-space: nowrap;
}


.suggest_button_active {
    background-color: #DDDDDD;
}


.suggest_button:hover {
    background-color: #DDDDDD;
}


#rbql_error_message {
    width: 50%;
    top: 20%;
    left: 25%;
    z-index: 1000000;
    background-color: #FFFCD3;
    position: fixed;
    display: none;
    color: black;
}

#rbql_error_message_header {
    font-size: 18px;
    height: 26px;
    font-weight: bold;
}

#ack_error {
    width: 70px;
    background-color: #FF4444;
    display: inline-block;
    transition-duration: 0.3s;
    border:none;
    font-size: 18px;
    height: 28px;
    font-weight: bold;
}

#ack_error:hover {
    background-color: #b70101;
}

#error_message_details {
    height: 100px;
    overflow: auto;
    border: 1px solid black;
    white-space: pre;
    margin: 5px;
    background-color: #FFFFFF;
}


</style>
</head>

<body>

<div class="infoheader">
    <div class="right_header_block"><a class="simple_link" href="https://github.com/mechatroner/RBQL">GitHub</a></div>
    <div class="right_header_block"><a class="simple_link" href="https://github.com/mechatroner/RBQL/blob/master/README.md#rbql-rainbow-query-language-description">Documentation</a></div>
    <div class="right_header_block"><a class="simple_link" href="#demo">Online Web Demo</a></div>
</div>

<div class="content_group">
    <a href="https://rbql.org/"><img src="resources/images/logo.png" title="Parrots can speak many languages, but they don't really understand them"></a>
    <h1 style="display">
        Rainbow Query Language
    </h1>
    <!-- FIXME spell check -->
    <div class="description_paragraph">
        RBQL is a technology that provides SQL-like language for data-transformation and data-analysis queries for structured data (e.g. CSV files, log files, Python lists, JS arrays). RBQL evaluates input query using one of the available general-purpose "backend" languages (currently Python or JavaScript). RBQL allows to use non-SQL expressions inside SQL statements, e.g for JavaScript backend:
        <div class="code_snippet"><span class="red_span">select</span> a1, a2 * 10 <span class="red_span">where</span> a1 == &quot;Buy&quot; &amp;&amp; a4.indexOf('oil') != -1 <span class="red_span">order by</span> parseInt(a2), a4 <span class="red_span">limit 100</span></div>
        Combination of SQL statements and expressions from a general-purpose language makes RBQL very easy to learn and use, you just need a basic understanding of SQL and one of the available backend languages. So maybe you already know RBQL!
        The first word &quot;Rainbow&quot; in RBQL reflects its diverse multi-language nature.
        <br>
        <br>
        RBQL has simple modular design and no third-party dependencies. It is available as standalone CLI apps, text editor plugins and 2 libraries (for Python and JS) which would allow you to easily enhance your own app with SQL capabilities.
    </div>

    <div class="description_paragraph">
        RBQL is available for the following platforms:
        <ul>
        <li><a href="https://pypi.org/project/rbql/">RBQL</a> &ndash; CLI App and library for Python (PyPI)</li>
        <li><a href="https://www.npmjs.com/package/rbql">RBQL</a> &ndash; CLI App and library for Node.js (npm)</li>
        <li><a href="https://github.com/mechatroner/rainbow_csv">Rainbow CSV</a> &ndash; extension for Vim editor</li>
        <li><a href="https://marketplace.visualstudio.com/items?itemName=mechatroner.rainbow-csv">Rainbow CSV</a> &ndash; extension for Visual Studio Code editor</li>
        <li><a href="https://packagecontrol.io/packages/rainbow_csv">Rainbow CSV</a> &ndash; extension for Sublime Text 3 editor</li>
        <li><a href="https://atom.io/packages/rainbow-csv">Rainbow CSV</a> &ndash; extension for Atom editor</li>
        </ul>
    </div>
    <div class="description_paragraph">
        RBQL supports all main SQL keywords: SELECT, UPDATE, WHERE, ORDER BY, JOIN, DISTINCT, GROUP BY, TOP, LIMIT, ...
        <br>
        ... And some cool features that traditional SQL engines do not provide!
        <br>
        <br>
        RBQL implementation is based on a clever hack, see the explanation below if you are curious.
        <button class="expandable_button" id="show_explanation_button">+&nbsp;&nbsp;How RBQL works: Explanation</button>
        <div class="expandable_block" id="explanation_block" style="display:none">
            RBQL parses SQL-like user query, creates a new python or JavaScript worker module, then imports and executes it.
            <br>
            <br>
            Explanation of simplified Python version of RBQL algorithm by example.
            <br>
            User enters the following query, which is stored as a string Q:
            <div class="code_snippet">
                SELECT a3, int(a4) + 100, len(a2) WHERE a1 != 'SELL'
            </div>
            RBQL replaces all a{i} substrings in the query string Q with a[{i - 1}] substrings. The result is the following string:
            <div class="code_snippet">
                Q = "SELECT a[2], int(a[3]) + 100, len(a[1]) WHERE a[0] != 'SELL'"
            </div>
            RBQL searches for "SELECT" and "WHERE" keywords in the query string Q, throws the keywords away, and puts everything after these keywords into two variables S - select part and W - where part, so we will get:
            <div class="code_snippet">
                S = "a[2], int(a[3]) + 100, len(a[1])"
                <br>
                W = "a[0] != 'SELL'"
            </div>
            RBQL has a static template script which looks like this:
            <div class="code_snippet">
                for line in sys.stdin:
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;a = line.rstrip('\n').split('\t')
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;if %%%W_Expression%%%:
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out_fields = [%%%S_Expression%%%]
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print '\t'.join([str(v) for v in out_fields])
            </div>
            RBQL replaces %%%W_Expression%%% with W and %%%S_Expression%%% with S so we get the following script:
            <div class="code_snippet">
                for line in sys.stdin:
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;a = line.rstrip('\n').split('\t')
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;if a[0] != 'SELL':
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out_fields = [a[2], int(a[3]) + 100, len(a[1])]
                <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print '\t'.join([str(v) for v in out_fields])
            </div>
            RBQL runs the patched script against user's data file:
            <div class="code_snippet">
                ./tmp_script.py &lt; data.tsv &gt; result.tsv
            </div>
            Result set of the original query (SELECT a3, int(a4) + 100, len(a2) WHERE a1 != 'SELL') is in the "result.tsv" file. It is clear that this simplified version can only work with tab-separated files.
        </div>
    </div>
</div>


<div class="content_group">
    <h1 id="demo">
        RBQL Web Demo
    </h1>
    <div class="description_paragraph">
        In this Web Demo only JavaScript backend is available.<br>
        <button class="expandable_button" id="show_examples_button">+&nbsp;&nbsp;Show Query Examples</button>
        <div class="expandable_block" id="examples_block" style="display:none">
            <div style="margin-bottom:4px"><span class="code_snippet_small">SELECT top 10 * WHERE a7.indexOf('Sci-Fi') != -1 &amp;&amp; a4 &gt; 2010 order by parseInt(a4), parseInt(a8) desc</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; Simple query </span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">SELECT a1, a2, a4 WHERE parseInt(a4) &gt; 2014 order by a1</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; Actually no need for "parseInt()" here, just a reminder that column vars are strings</span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">select * order by Math.random()</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; Random shuffle</span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">select COUNT(*), a2 group by a2</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; Aggregate query</span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">UPDATE SET a8 = a8 / 60</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; UPDATE is just a special type of SELECT</span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">select top 20 NR, *</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; Enumerate records</span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">select JSON.stringify({name: a1, country: a2})</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; Convert CSV to JSON records. How cool is that? </span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">select `mv '${a1}.mp4' '${a4}_${a1.toLowerCase()}.mp4'`</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; Make a bash script to rename files, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">this is valid JS syntax</a></span></div>
            <div style="margin-bottom:4px"><span class="code_snippet_small">select a1, a100</span><span class="code_explanation_small">&nbsp;&nbsp;&mdash; RBQL has warnings!</span></div>
        </div>
    </div>
    <div class="table_control_group">
        <div>
            <span>Use the default test table below or "upload" your own.<span><br>
            <span>Your data is safe: selected table doesn't actually get uploaded anywhere - all operations are performed locally in the browser.</span><br>
            <span>Every query result is a first-class table.</span>
        </div>
        <button class="dark_button" id="open_custom_table_dialog" style="width: 150px" title="Select your own table from disk (optional)">Upload...</button>
        <button class="dark_button" id="open_udf_dialog" style="margin-top: 5px; width: 150px" title="Enter User Defined Functions (optional)">Add UDF...</button>
    </div>
    <div id="udf_holder">
        <textarea id="udf_text_area" rows="6" cols="100"></textarea>
    </div>
    <div id="table_chain_holder">
    </div>
</div>



<div id="table_load_dialog">
    <div id="default_join_info" style="display:none; margin-bottom:20px;">
    <button id="upload_default_join" class="dark_button" style="margin-bottom:10px;">Use demo join table</button>
    You can use the default demo join table or upload your own:
    </div>
    <span>Select spreadsheet file to use. Your data is safe: the file won't be sent over network - all operations are performed locally in the browser. Performance of this demo is limited by your browser processing capabilities - do not submit very big files!</span><br>
    <br>
    <span class="infoMsg">1.</span><input id="doLoadTable" type="file"/>
    <br>
    <br>
    <span class="infoMsg">2. Choose file separator character:</span>
    <select id="separator_ddl">
        <option disabled selected value> -- choose separator char -- </option>
        <option value="tsv">TAB (\t)</option>
        <option value="csv">Comma (,)</option>
        <option value="csv (semicolon)">Semicolon (;)</option>
        <option value="csv (pipe)">Pipe (|)</option>
    </select>
    <br>
    <br>
    <div>
    <button id="cancelSubmit" class="dark_button" style="display: inline-block">Cancel</button>
    <button id="tableSubmit" class="dark_button" style="display: inline-block">Submit</button>
    </div>
</div>


<div class="rbql_query_group" id="proto_query_group" style="display:none">
    <div style="margin-bottom: 8px"><label style="word-wrap:break-word"><input type="checkbox" title="Skip header row: you would still be able to use column names from it in your query. Roughly equivalent to ... WHERE NR > 1 ..."/>Skip header row</label></div>
    <div style="margin-bottom: 4px"><span>To refer to the table columns use index names: <i>a1</i>, <i>a2</i>, <i>a3</i>, ... and <i>NR</i><br>and/or values from the first row e.g. <i>a.Title</i>, <i>a.Country</i> and <i>a["Film type"]</i></span></div>
    <input type="text" style="width:70%" placeholder="select ... where ... order by ... limit ... ">
    <button class="rbql_run_button">Run</button>
</div>


<div id="query_suggest">
</div>


<div id="rbql_error_message">
    <div id="rbql_error_message_header">
        <span id="error_header" class="padded_label"></span>
    </div>
    <br>
    <div>
        <span class="padded_label" id="error_message_header"></span>
    </div>
    <br>
    <div>
        <span class="padded_label">Details:</span>
        <br>
        <div id="error_message_details"></div>
    </div>
    <div style="display: flex; justify-content:center;">
        <button id="ack_error">OK</button>
    </div>
</div>


<div class="footer">
    <div id="contacts_block"><a class="simple_link" href="mailto:mechatroner@yandex.ru">Contacts</a></div>
    <a href="https://twitter.com/"><img id="twitter_img" src="resources/images/twitter.png" height="32" width="32"></a>
</div>

</body>

</html>
